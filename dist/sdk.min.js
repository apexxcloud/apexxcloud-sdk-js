!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ApexxCloudSDK=t()}(this,(function(){"use strict";return class{constructor(e={}){this.config={baseUrl:e.baseUrl||"https://api.apexxcloud.com"},this.files={upload:this.uploadFile.bind(this),uploadMultipart:this.uploadMultipart.bind(this)}}async uploadMultipart(e,t,{onProgress:a=()=>{},onPartComplete:r=()=>{},onComplete:o=()=>{},onError:s=()=>{},partSize:n=5242880,signal:p,concurrency:i=3}={}){try{const l=await t("start-multipart",{key:e.name,totalParts:Math.ceil(e.size/n),mimeType:e.type}),d=()=>new Promise(((t,a)=>{const r=new XMLHttpRequest;if(p?.aborted)return s({type:"abort",error:new Error("Upload aborted"),phase:"start",timestamp:new Date}),void a(new Error("Upload aborted"));r.open("POST",l),r.setRequestHeader("Content-Type","application/json"),r.onload=()=>{if(r.status>=200&&r.status<300){const e=JSON.parse(r.responseText);t(JSON.parse(e.data.data))}else{const e=new Error(`Start upload failed with status ${r.status}`);s({type:"error",error:e,phase:"start",status:r.status,timestamp:new Date}),a(e)}},r.onerror=()=>{const e=new Error("Start upload failed");s({type:"error",error:e,phase:"start",timestamp:new Date}),a(e)},r.send(JSON.stringify({filename:e.name,contentType:e.type,size:e.size}))})),{uploadId:u}=await d(),m=Math.ceil(e.size/n),c=[];let w=0;const y=async o=>{const i=(o-1)*n,l=Math.min(i+n,e.size),d=e.slice(i,l),c=await t("uploadpart",{uploadId:u,partNumber:o,key:e.name,totalParts:m});return new Promise(((t,n)=>{const u=new XMLHttpRequest;p?.aborted?n(new Error("Upload aborted")):(u.upload.onprogress=t=>{if(t.lengthComputable){const r=t.loaded/t.total,s=(l-i)*r,n=(w+s)/e.size*100;a({loaded:w+s,total:e.size,progress:n,part:{number:o,progress:100*r}})}},u.open("POST",c),u.onload=()=>{if(u.status>=200&&u.status<300){const e=u.getResponseHeader("ETag");w+=d.size;const a={ETag:e,PartNumber:o};r(a),t(a)}else{let e;try{e=JSON.parse(u.responseText).message||`Part upload failed with status ${u.status}`}catch(t){e=u.responseText||`Part upload failed with status ${u.status}`}const t=new Error(e);s({type:"error",error:t,phase:"upload",partNumber:o,status:u.status,timestamp:new Date}),n(t)}},u.onerror=()=>n(new Error("Part upload failed")),u.send(d))}))};for(let e=0;e<m;e+=i){const t=Array.from({length:Math.min(i,m-e)},((t,a)=>e+a+1)),a=await Promise.all(t.map((e=>y(e))));c.push(...a)}const f=await t("completemultipart",{uploadId:u,key:e.name}),h=()=>new Promise(((t,a)=>{const r=new XMLHttpRequest;r.open("POST",f),r.setRequestHeader("Content-Type","application/json"),r.onload=()=>{if(r.status>=200&&r.status<300){const a=JSON.parse(r.responseText);o({type:"complete",response:a,timestamp:new Date,file:{name:e.name,size:e.size,type:e.type}}),t(a.data.data)}else a(new Error(`Complete upload failed with status ${r.status}`))},r.onerror=()=>a(new Error("Complete upload failed")),r.send(JSON.stringify({parts:c.sort(((e,t)=>e.PartNumber-t.PartNumber))}))}));return await h()}catch(e){throw s({type:"error",error:e,phase:"upload",timestamp:new Date}),e}}async uploadFile(e,t,{onProgress:a=()=>{},onComplete:r=()=>{},onError:o=()=>{},onStart:s=()=>{},signal:n}={}){try{const p=await t("upload",{key:e.name,mimeType:e.type}),i=new XMLHttpRequest;if(n?.aborted)throw o({type:"abort",error:new Error("Upload aborted"),timestamp:new Date}),new Error("Upload aborted");return n?.addEventListener("abort",(()=>i.abort())),new Promise(((t,n)=>{i.open("PUT",p),i.upload.onprogress=e=>{if(e.lengthComputable){const t=e.loaded/e.total*100;a({loaded:e.loaded,total:e.total,progress:t,type:"progress"})}},i.upload.onloadstart=()=>{s({type:"start",timestamp:new Date,file:{name:e.name,size:e.size,type:e.type}})},i.onload=()=>{if(i.status>=200&&i.status<300)try{const a=JSON.parse(i.responseText);r({type:"complete",response:a,timestamp:new Date,file:{name:e.name,size:e.size,type:e.type}}),t(a.data.data)}catch(a){r({type:"complete",response:i.responseText,timestamp:new Date,file:{name:e.name,size:e.size,type:e.type}}),t(i.responseText)}else{const e=new Error(`Upload failed with status ${i.status}`);o({type:"error",error:e,status:i.status,timestamp:new Date}),n(e)}},i.onerror=()=>{const e=new Error("Upload failed");o({type:"error",error:e,timestamp:new Date}),n(e)},i.onabort=()=>{const e=new Error("Upload aborted");o({type:"abort",error:e,timestamp:new Date}),n(e)};const l=new FormData;l.append("file",e),i.send(l)}))}catch(e){throw o({type:"error",error:e,timestamp:new Date}),e}}}}));
//# sourceMappingURL=sdk.min.js.map
